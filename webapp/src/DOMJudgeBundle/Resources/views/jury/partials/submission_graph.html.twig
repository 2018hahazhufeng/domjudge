<div>
  {% if jdata|length > 1 %}
  <div style="display: inline-block" id="maxruntime">
    <h3 id="graphs">Max Runtimes</h3>
    <svg width="500" height="250"></svg>
  </div>
  {% endif %}
  <div style="display: inline-block" id="testcaseruntime">
    <h3 id="graphs">Testcase Runtimes</h3>
    <svg width="500" height="250"></svg>
  </div>
</div>

<script type="text/javascript">
function create_chart(data) {
  var chart = nv.models.discreteBarChart()
      .x(function(d) { return d.label })
      .y(function(d) { return d.value })
      .valueFormat(d3.format('.3f'))
      .staggerLabels(data[0].values.length > 8)
      .forceY([0,{{ (timelimit*0.20) + timelimit }}])
      .showValues(true)
      .duration(250)
      ;
  chart.yAxis
    .tickFormat(d3.format('.3f'))
    .axisLabel('Runtime(in s)');
  return chart;
}
$(function(){
  {% if jdata|length > 1%}
    var run_max_times = [
      {
        key: "Max Runtimes",
        values: [
          {% for runid, run in jdata %}
            {
              "label" : "j{{ runid }}",
              "value" : {{ run["max_runtime"]|default(0) }}
            },
          {% endfor %}
        ]
      }
    ];
    nv.addGraph(function() {
        var chart  = create_chart(run_max_times);
        chart.xAxis.axisLabel("Judging");
        d3.select('#maxruntime svg')
            .datum(run_max_times)
            .call(chart);
        var line = d3.select('#maxruntime svg')
            .append('line')
            .attr({
              x1: 60,
              y1: 15 + chart.yAxis.scale()({{timelimit}}),
              x2: 490,
              y2: 15 + chart.yAxis.scale()({{timelimit}}),
            })
            .style("stroke", "#F00");
        nv.utils.windowResize(chart.update);
        return chart;
    });
  {% endif %}

  var testcase_times = [
    {
      key: "Testcase Runtimes",
      values: [
        {% for run in runs %}

          {
            "label" : "{{ run["rank"] }}",
            "value" : {{ run["runtime"]|default(0) }},
          },
        {% endfor %}
      ]
    }
  ];
  nv.addGraph(function() {
      var chart  = create_chart(testcase_times);
      chart.xAxis.axisLabel("Testcase");
      d3.select('#testcaseruntime svg')
          .datum(testcase_times)
          .call(chart);

      var line = d3.select('#testcaseruntime svg')
          .append('line')
          .attr({
            x1: 60,
            y1: 15 + chart.yAxis.scale()({{timelimit}}),
            x2: 490,
            y2: 15 + chart.yAxis.scale()({{timelimit}}),
          })
          .style("stroke", "#F00");
      nv.utils.windowResize(chart.update);
      return chart;
  });
})
</script>
