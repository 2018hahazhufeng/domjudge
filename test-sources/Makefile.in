ifndef TOPDIR
TOPDIR=..
endif
include $(TOPDIR)/Makefile.global

TARGETS = check-judgings

build: $(TARGETS)

check-judgings: check-judgings.in Makefile
# Do copy to preserve file permissions (executable bit)
	cp $< $@
	cat $< | \
	sed -e "s|@configure_input[@]|Generated from '$<', do not edit by hand.|g" \
	    -e "s,@domserver_etcdir[@],@domserver_etcdir@,g" > $@

check: test-normal test-fltcmp

verify: check-judgings
	./check-judgings

test-normal:
	@echo "Submitting normal test sources..." ; \
	for i in test-* ; do \
		echo "Submitting '$$i'" ; \
		$(TOPDIR)/submit/submit -q -p hello "$$i" ; \
		sleep 1 ; \
	done

test-fltcmp:
	@echo "Submitting fltcmp test sources..." ; \
		for i in fltcmp-test-* ; do \
		echo "Submitting '$$i'" ; \
		$(TOPDIR)/submit/submit -q -p fltcmp "$$i" ; \
		sleep 1 ; \
	done

test-stress:
	@echo "Submitting stress test sources..." ; \
	for i in stress-test-* ; do \
		echo "Submitting '$$i'" ; \
		$(TOPDIR)/submit/submit -q -p hello "$$i" ; \
		sleep 1 ; \
	done

.PHONY: test-normal test-fltcmp test-stress verify
