ifndef TOPDIR
TOPDIR=..
endif
include $(TOPDIR)/Makefile.global

TARGETS = check_float compare

LIBSBASE = $(addprefix $(TOPDIR)/lib/,lib.error lib.misc)
LIBHEADERS = $(addsuffix .h,$(LIBSBASE))
LIBOBJECTS = $(addsuffix .o,$(LIBSBASE))

judgehost: build

build: $(TARGETS)

$(LIBOBJECTS):
	$(MAKE) -C $(TOPDIR)/lib $(notdir $@)

compare: %: %.c $(LIBOBJECTS) $(LIBHEADERS)
	$(CC) $(CFLAGS) $(patsubst %.h,,$^) -o $@
	$(STRIP) $@

check_float: %: %.c
	$(CC) -std=c99 $(CFLAGS) $^ -o $@
	$(STRIP) $@

install-judgehost:
	install -d @judgehost_libjudgedir@ @judgehost_bindir@
	cp -a compile_*.sh parse_result.xslt test_solution.sh run \
	      compare check_diff.sh check_float chroot-startstop.sh \
	      @judgehost_libjudgedir@
	cp -a judgedaemon.php @judgehost_bindir@
	chmod a+x @judgehost_bindir@/judgedaemon.php

clean:
	-rm -f $(TARGETS)
